{% extends "base.html" %}
{% load static %}

{% block title %}Shop - FOXXY DRIP{% endblock title %}
{% block shopactive %}active{% endblock shopactive %}

{% block body %}
{% block extracss %}
<link rel="stylesheet" href="{% static 'css/shop.css' %}" />
<style>
.card-img-top {
    width: 100%;
    height: 300px;
    object-fit: cover;
}
.price {
    font-size: 1.2rem;
    font-weight: 600;
}
.text-strike {
    text-decoration: line-through;
    color: #888;
}
.btn-view {
    background-color: #000;
    color: #fff;
    border: none;
}
.btn-view:hover {
    background-color: #d63384;
    color: #fff;
}
</style>
{% endblock extracss %}

<div class="container mt-4">
  <h2 class="mb-4 fw-bold">Our Collection</h2>
  <div class="row">
    {% for item in products_with_designs %}
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm border-0 rounded-3 product-card">

          <!-- Carousel for multiple design images -->
          {% if item.design and item.design.images.all %}
            <div id="carousel-{{ item.design.id }}" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-inner">
                {% for img in item.design.images.all %}
                  <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <img src="{{ img.image.url }}" class="d-block w-100 card-img-top" alt="{{ item.design.name }}">
                  </div>
                {% endfor %}
              </div>
              {% if item.design.images.count > 1 %}
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel-{{ item.design.id }}" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel-{{ item.design.id }}" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                </button>
              {% endif %}
            </div>
          {% elif item.image %}
            <img src="{{ item.image.image.url }}" class="card-img-top" alt="{{ item.product.name }}">
          {% else %}
            <img src="https://via.placeholder.com/400x400?text=No+Image" class="card-img-top" alt="{{ item.product.name }}">
          {% endif %}

          <div class="card-body d-flex flex-column">
            {% if item.design %}
              <h5 class="card-title fw-bold">{{ item.design.name }}</h5>
            {% endif %}
            <p class="text-muted mb-1">{{ item.product.name }}</p>
            <p class="text-muted mb-1"><strong>Color:</strong> {{ item.color.name }}</p>

            <!-- Price Section -->
            <p class="price mb-2">
              {% if item.design and item.design.type %}
                {% if item.design.type.discount_price %}
                  <span class="text-strike">₹{{ item.design.type.price }}</span>
                  <span class="text-danger ms-2">₹{{ item.design.type.discounted_price }}</span>
                  <span class="badge bg-danger ms-2">-{{ item.design.type.discount_percent }}%</span>
                {% else %}
                  ₹{{ item.design.type.price }}
                {% endif %}
              {% endif %}
            </p>

            {% if item.design %}
              <a href="{% url 'design_detail' item.design.id %}" class="btn btn-view mt-auto w-100">View</a>
            {% else %}
              <a href="{% url 'view_product' item.product.product_id %}" class="btn btn-view mt-auto w-100">View</a>
            {% endif %}

          </div>
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% endblock body %}
